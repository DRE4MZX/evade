local rs = game:GetService("ReplicatedStorage")
local plr = game:GetService("Players").LocalPlayer
local cas = game:GetService("ContextActionService")
local ts = game:GetService("TweenService")
local uis = game:GetService("UserInputService")

local act = rs.Events.Character.ToolAction
local toolType = "Teleporter"
local fd, up, dl, n = 10, 0.001, 0.01, 1
local timpaEnabled = true
local uiDestroyed = false

local function fele()
	if not timpaEnabled then return end
	local hrp = (plr.Character or plr.CharacterAdded:Wait()):WaitForChild("HumanoidRootPart")
	local pos = hrp.Position + hrp.CFrame.LookVector * fd
	local ray = workspace:Raycast(pos + Vector3.new(0,20,0), Vector3.new(0,-50,0), RaycastParams.new())
	if ray then pos = ray.Position end
	for i=1,n do
		pcall(function()
			act:FireServer(1, {toolType, CFrame.new(pos + Vector3.new(0, (i-1)*up, 0))})
		end)
		task.wait(dl)
	end
end

local function bindL()
	cas:UnbindAction("TelePlace")
	cas:BindAction("TelePlace", function(_, s)
		if s == Enum.UserInputState.Begin then fele() end
	end, false, Enum.KeyCode.L)
end
plr.CharacterAdded:Connect(bindL)
if plr.Character then bindL() end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TeleporterUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = plr:WaitForChild("PlayerGui")

local frame = Instance.new("Frame", screenGui)
frame.AnchorPoint = Vector2.new(0.5, 0.5)
frame.Position = UDim2.new(0.2, 0, 0.2, 0)
frame.Size = UDim2.new(0.1, 0, 0.15, 0)
frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
frame.BackgroundTransparency = 0.1
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,10)

local titleBar = Instance.new("Frame", frame)
titleBar.Size = UDim2.new(1, 0, 0.18, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(35,35,35)
Instance.new("UICorner", titleBar).CornerRadius = UDim.new(0,10)

local title = Instance.new("TextLabel", titleBar)
title.Text = "EL TIMPA"
title.Size = UDim2.new(1, -30, 1, 0)
title.Position = UDim2.new(0, 8, 0, 0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.TextColor3 = Color3.new(1,1,1)
title.TextXAlignment = Enum.TextXAlignment.Left

local close = Instance.new("TextButton", titleBar)
close.Size = UDim2.new(0, 25, 1, 0)
close.Position = UDim2.new(1, -25, 0, 0)
close.Text = "X"
close.Font = Enum.Font.GothamBold
close.TextScaled = true
close.TextColor3 = Color3.fromRGB(255,80,80)
close.BackgroundTransparency = 1
close.MouseButton1Click:Connect(function()
	frame.Visible = false
end)

local dropdown = Instance.new("TextButton", frame)
dropdown.Size = UDim2.new(0.9, 0, 0.18, 0)
dropdown.Position = UDim2.new(0.05, 0, 0.25, 0)
dropdown.Text = toolType
dropdown.Font = Enum.Font.Gotham
dropdown.TextScaled = true
dropdown.TextColor3 = Color3.new(1,1,1)
dropdown.BackgroundColor3 = Color3.fromRGB(50,50,50)
Instance.new("UICorner", dropdown).CornerRadius = UDim.new(0,8)

local options = {"Teleporter", "Landmine", "JumpPad", "Speedpad", "Portal", "SpringPad", "Booster"}

local menu = Instance.new("ScrollingFrame", frame)
menu.Position = UDim2.new(0.05,0,0.45,0)
menu.Size = UDim2.new(0.9,0,0.5,0)
menu.BackgroundColor3 = Color3.fromRGB(30,30,30)
menu.ScrollBarThickness = 4
menu.Visible = false
menu.AutomaticCanvasSize = Enum.AutomaticSize.Y
menu.ZIndex = 2
Instance.new("UICorner", menu).CornerRadius = UDim.new(0,8)

local layout = Instance.new("UIListLayout", menu)
layout.Padding = UDim.new(0,5)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Top

for _,opt in ipairs(options) do
	local btn = Instance.new("TextButton", menu)
	btn.ZIndex = 2
	btn.Size = UDim2.new(0.95,0,0.3,0)
	btn.BackgroundColor3 = Color3.fromRGB(45,45,45)
	btn.Text = opt
	btn.TextColor3 = Color3.new(1,1,1)
	btn.Font = Enum.Font.Gotham
	btn.TextScaled = true
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)

	btn.MouseEnter:Connect(function()
		ts:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(70,70,70)}):Play()
	end)
	btn.MouseLeave:Connect(function()
		ts:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(45,45,45)}):Play()
	end)
	btn.MouseButton1Click:Connect(function()
		toolType = opt
		dropdown.Text = opt
		menu.Visible = false
	end)
end

dropdown.MouseButton1Click:Connect(function()
	menu.Visible = not menu.Visible
end)

local toggleBtn = Instance.new("TextButton", frame)
toggleBtn.Size = UDim2.new(0.9, 0, 0.15, 0)
toggleBtn.Position = UDim2.new(0.05, 0, 0.56, 0)
toggleBtn.Text = "Timpa : ON"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextScaled = true
toggleBtn.BackgroundColor3 = Color3.fromRGB(45,85,45)
toggleBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0,8)

toggleBtn.MouseButton1Click:Connect(function()
	timpaEnabled = not timpaEnabled
	if timpaEnabled then
		toggleBtn.Text = "Timpa : ON"
		toggleBtn.BackgroundColor3 = Color3.fromRGB(45,85,45)
	else
		toggleBtn.Text = "Timpa : OFF"
		toggleBtn.BackgroundColor3 = Color3.fromRGB(100,40,40)
	end
end)

local destroyBtn = Instance.new("TextButton", frame)
destroyBtn.Size = UDim2.new(0.9,0,0.13,0)
destroyBtn.Position = UDim2.new(0.05,0,0.75,0)
destroyBtn.Text = "Destroy UI"
destroyBtn.Font = Enum.Font.GothamBold
destroyBtn.TextScaled = true
destroyBtn.TextColor3 = Color3.new(1,1,1)
destroyBtn.BackgroundColor3 = Color3.fromRGB(80,40,40)
Instance.new("UICorner", destroyBtn).CornerRadius = UDim.new(0,8)

local hint = Instance.new("TextLabel", frame)
hint.Size = UDim2.new(1,0,0.08,0)
hint.Position = UDim2.new(0.05,0,0.97,0)
hint.AnchorPoint = Vector2.new(0,1)
hint.BackgroundTransparency = 1
hint.Font = Enum.Font.Gotham
hint.TextScaled = false
hint.TextSize = 10
hint.TextColor3 = Color3.fromRGB(200,200,200)
hint.Text = "[L] Place " .. toolType .. "  |  [K] Show UI"
hint.TextWrapped = true

dropdown:GetPropertyChangedSignal("Text"):Connect(function()
	hint.Text = "[L] Place " .. dropdown.Text .. "  |  [K] Show UI"
end)

destroyBtn.MouseButton1Click:Connect(function()
	uiDestroyed = true
	screenGui:Destroy()
end)

local dragging, dragStart, startPos
titleBar.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
	end
end)
uis.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)
uis.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
	end
end)

uis.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.K and not uiDestroyed then
		frame.Visible = not frame.Visible
	end
end)
