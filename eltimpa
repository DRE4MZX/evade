local rs = game:GetService("ReplicatedStorage")
local plr = game:GetService("Players").LocalPlayer
local cas = game:GetService("ContextActionService")
local ts = game:GetService("TweenService")
local uis = game:GetService("UserInputService")

local act = rs.Events.Character.ToolAction
local toolType = "Teleporter"
local fd, up, dl, n = 10, 0.001, 0.01, 1
local timpaEnabled = true
local uiDestroyed = false

local function getGroundBelow(position)
	local rayOrigin = position + Vector3.new(0, 5, 0)
	local rayDirection = Vector3.new(0, -100, 0)
	local params = RaycastParams.new()
	params.FilterDescendantsInstances = {plr.Character}
	params.FilterType = Enum.RaycastFilterType.Blacklist
	return workspace:Raycast(rayOrigin, rayDirection, params)
end

local function getGroundCFrameAbovePosition(position, rotation)
	local result = getGroundBelow(position)
	if result then
		return CFrame.new(result.Position + Vector3.new(0, 0.05, 0)) * CFrame.Angles(0, rotation, 0)
	else
		return CFrame.new(position) * CFrame.Angles(0, rotation, 0)
	end
end

local function fele()
	if not timpaEnabled then return end
	local char = plr.Character or plr.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")
	if not hrp then return end

	local rotY = select(2, hrp.CFrame:ToEulerAnglesYXZ())
	local pos = hrp.Position + hrp.CFrame.LookVector * fd
	local baseCFrame = getGroundCFrameAbovePosition(pos, rotY)

	for i = 1, n do
		local newCFrame = baseCFrame * CFrame.new(0, (i - 1) * up, 0)
		pcall(function()
			if act then
				act:FireServer(1, {toolType, newCFrame})
			end
		end)
		task.wait(dl)
	end
end

if cas then
	pcall(function() cas:UnbindAction("TelePlace") end)
	cas:BindAction("TelePlace", function(_, state)
		if state == Enum.UserInputState.Begin then
			pcall(fele)
		end
	end, false, Enum.KeyCode.L)
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TeleporterUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = plr:WaitForChild("PlayerGui")

local frame = Instance.new("Frame", screenGui)
frame.AnchorPoint = Vector2.new(0.5, 0.5)
frame.Position = UDim2.new(0.2, 0, 0.3, 0)
frame.Size = UDim2.new(0.17, 0, 0.28, 0)
frame.BackgroundColor3 = Color3.fromRGB(15, 20, 35)
frame.BackgroundTransparency = 0.3
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)

local border = Instance.new("UIStroke", frame)
border.Thickness = 2
border.Color = Color3.fromRGB(0, 180, 255)
border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

local grid = Instance.new("ImageLabel", frame)
grid.Size = UDim2.new(1,0,1,0)
grid.BackgroundTransparency = 1
grid.Image = "rbxassetid://13981788076" -- hologram grid subtle
grid.ImageColor3 = Color3.fromRGB(0,150,255)
grid.ImageTransparency = 0.9
grid.ScaleType = Enum.ScaleType.Tile
grid.TileSize = UDim2.new(0,60,0,60)
grid.ZIndex = 0

local titleBar = Instance.new("Frame", frame)
titleBar.Size = UDim2.new(1, 0, 0.15, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(20,25,45)
titleBar.BackgroundTransparency = 0.2
titleBar.BorderSizePixel = 0
Instance.new("UICorner", titleBar).CornerRadius = UDim.new(0,10)

local titleStroke = Instance.new("UIStroke", titleBar)
titleStroke.Thickness = 1.5
titleStroke.Color = Color3.fromRGB(0,180,255)
titleStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

local title = Instance.new("TextLabel", titleBar)
title.Text = "EL TIMPA"
title.Size = UDim2.new(1, -35, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.TextColor3 = Color3.fromRGB(0, 200, 255)
title.TextStrokeTransparency = 0.8
title.TextXAlignment = Enum.TextXAlignment.Left

local close = Instance.new("TextButton", titleBar)
close.Size = UDim2.new(0, 40, 1, 0)
close.Position = UDim2.new(1, -40, 0, 0)
close.Text = "Ã—"
close.Font = Enum.Font.GothamBold
close.TextScaled = true
close.TextColor3 = Color3.fromRGB(255,80,80)
close.BackgroundTransparency = 1
close.MouseButton1Click:Connect(function()
	frame.Visible = false
end)

local dropdown = Instance.new("TextButton", frame)
dropdown.Size = UDim2.new(0.9, 0, 0.18, 0)
dropdown.Position = UDim2.new(0.05, 0, 0.2, 0)
dropdown.Text = toolType
dropdown.Font = Enum.Font.Gotham
dropdown.TextScaled = true
dropdown.TextColor3 = Color3.fromRGB(200,255,255)
dropdown.BackgroundColor3 = Color3.fromRGB(25,35,55)
dropdown.BackgroundTransparency = 0.15
dropdown.AutoButtonColor = false
Instance.new("UICorner", dropdown).CornerRadius = UDim.new(0,10)
local ds = Instance.new("UIStroke", dropdown)
ds.Color = Color3.fromRGB(0,170,255)
ds.Thickness = 1.4
ds.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

local options = {"Teleporter", "Landmine", "JumpPad", "Speedpad", "Portal", "SpringPad", "Booster", "Beacon"}

local menu = Instance.new("ScrollingFrame", frame)
menu.Position = UDim2.new(0.05,0,0.38,0)
menu.Size = UDim2.new(0.9,0,0.5,0)
menu.BackgroundColor3 = Color3.fromRGB(15,20,35)
menu.BackgroundTransparency = 0.3
menu.ScrollBarThickness = 4
menu.Visible = false
menu.AutomaticCanvasSize = Enum.AutomaticSize.Y
menu.ZIndex = 2
Instance.new("UICorner", menu).CornerRadius = UDim.new(0,10)
local ms = Instance.new("UIStroke", menu)
ms.Color = Color3.fromRGB(0,170,255)
ms.Thickness = 1.3

local layout = Instance.new("UIListLayout", menu)
layout.Padding = UDim.new(0,5)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.VerticalAlignment = Enum.VerticalAlignment.Top

for _,opt in ipairs(options) do
	local btn = Instance.new("TextButton", menu)
	btn.ZIndex = 2
	btn.Size = UDim2.new(0.95,0,0.3,0)
	btn.BackgroundColor3 = Color3.fromRGB(30,45,65)
	btn.BackgroundTransparency = 0.1
	btn.Text = opt
	btn.TextColor3 = Color3.new(0.9,1,1)
	btn.Font = Enum.Font.Gotham
	btn.TextScaled = true
	btn.AutoButtonColor = false
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)
	local st = Instance.new("UIStroke", btn)
	st.Color = Color3.fromRGB(0,150,255)
	st.Thickness = 1.2

	btn.MouseEnter:Connect(function()
		ts:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(40,65,90)}):Play()
	end)
	btn.MouseLeave:Connect(function()
		ts:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(30,45,65)}):Play()
	end)
	btn.MouseButton1Click:Connect(function()
		toolType = opt
		dropdown.Text = opt
		menu.Visible = false
	end)
end
dropdown.MouseButton1Click:Connect(function()
	menu.Visible = not menu.Visible
end)

local toggleBtn = Instance.new("TextButton", frame)
toggleBtn.Size = UDim2.new(0.9, 0, 0.15, 0)
toggleBtn.Position = UDim2.new(0.05, 0, 0.45, 0)
toggleBtn.Text = "Timpa : ON"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextScaled = true
toggleBtn.BackgroundColor3 = Color3.fromRGB(25,60,40)
toggleBtn.BackgroundTransparency = 0.15
toggleBtn.TextColor3 = Color3.new(0.9,1,0.9)
toggleBtn.AutoButtonColor = false
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0,10)
local tbStroke = Instance.new("UIStroke", toggleBtn)
tbStroke.Color = Color3.fromRGB(0,170,255)
tbStroke.Thickness = 1.3

toggleBtn.MouseButton1Click:Connect(function()
	timpaEnabled = not timpaEnabled
	if timpaEnabled then
		toggleBtn.Text = "Timpa : ON"
		toggleBtn.BackgroundColor3 = Color3.fromRGB(25,60,40)
	else
		toggleBtn.Text = "Timpa : OFF"
		toggleBtn.BackgroundColor3 = Color3.fromRGB(70,25,25)
	end
end)

local destroyBtn = Instance.new("TextButton", frame)
destroyBtn.Size = UDim2.new(0.9,0,0.15,0)
destroyBtn.Position = UDim2.new(0.05,0,0.63,0)
destroyBtn.Text = "Destroy UI"
destroyBtn.Font = Enum.Font.GothamBold
destroyBtn.TextScaled = true
destroyBtn.TextColor3 = Color3.new(1,0.8,0.8)
destroyBtn.BackgroundColor3 = Color3.fromRGB(50,25,35)
destroyBtn.BackgroundTransparency = 0.15
Instance.new("UICorner", destroyBtn).CornerRadius = UDim.new(0,10)
local dsb = Instance.new("UIStroke", destroyBtn)
dsb.Color = Color3.fromRGB(255,60,60)
dsb.Thickness = 1.4
destroyBtn.MouseButton1Click:Connect(function()
	uiDestroyed = true
	screenGui:Destroy()
end)

local hint = Instance.new("TextLabel", frame)
hint.Size = UDim2.new(1,0,0.08,0)
hint.Position = UDim2.new(0,0,0.90,0)
hint.BackgroundTransparency = 1
hint.Font = Enum.Font.Gotham
hint.TextScaled = true
hint.TextColor3 = Color3.fromRGB(0,200,255)
hint.TextStrokeTransparency = 0.8
hint.Text = "[L] Place " .. toolType .. "  |  [K] Show/Hide UI"
hint.TextWrapped = true
dropdown:GetPropertyChangedSignal("Text"):Connect(function()
	hint.Text = "[L] Place " .. dropdown.Text .. "  |  [K] Show/Hide UI"
end)

local dragging, dragStart, startPos
titleBar.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
	end
end)
uis.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement and dragging then
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)
uis.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
	end
end)

uis.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.K and not uiDestroyed then
		frame.Visible = not frame.Visible
	end
end)
